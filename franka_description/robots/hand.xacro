<?xml version="1.0" encoding="utf-8"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="hand">
  <xacro:macro name="hand" params="connected_to:='' ns:='' rpy:='0 0 0' xyz:='0 0 0' ">
    <xacro:unless value="${connected_to == ''}">
      <joint name="${ns}_hand_joint" type="fixed">
        <parent link="${connected_to}"/>
        <child link="${ns}_hand"/>
        <origin xyz="${xyz}" rpy="${rpy}"/>
      </joint>
    </xacro:unless>
    <link name="${ns}_hand">
      <visual>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/hand.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/hand.stl"/>
        </geometry>
      </collision>

      <!-- for simulation -->
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.68" />
        <inertia ixx="0.0013307028" ixy="0.0" ixz="0.0" iyy="0.0013307028" iyz="0.0" izz="0.0013307028" />
      </inertial>
      <!-- end for simulation -->
    </link>
    <link name="${ns}_leftfinger">
      <visual>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/finger.dae"/>
        </geometry>
      </visual>
      <collision>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/finger.stl"/>
        </geometry>
      </collision>

      <!-- for simulation -->
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.01" />
        <inertia ixx="1.6848e-06" ixy="0.0" ixz="0.0" iyy="1.6848e-06" iyz="0.0" izz="1.6848e-06" />
      </inertial>
      <!-- end for simulation -->
    </link>
    <link name="${ns}_rightfinger">
      <visual>
        <origin xyz="0 0 0" rpy="0 0 ${pi}"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/visual/finger.dae"/>
        </geometry>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 ${pi}"/>
        <geometry>
          <mesh filename="package://franka_description/meshes/collision/finger.stl"/>
        </geometry>
      </collision>

      <!-- for simulation -->
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.01" />
        <inertia ixx="1.6848e-06" ixy="0.0" ixz="0.0" iyy="1.6848e-06" iyz="0.0" izz="1.6848e-06" />
      </inertial>
      <!-- end for simulation -->
    </link>
    <joint name="${ns}_finger_joint1" type="prismatic">
      <parent link="${ns}_hand"/>
      <child link="${ns}_leftfinger"/>
      <origin xyz="0 0 0.0584" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="20" lower="0.0" upper="0.04" velocity="0.2"/>
    </joint>
    <joint name="${ns}_finger_joint2" type="prismatic">
      <parent link="${ns}_hand"/>
      <child link="${ns}_rightfinger"/>
      <origin xyz="0 0 0.0584" rpy="0 0 0"/>
      <axis xyz="0 -1 0"/>
      <limit effort="20" lower="0.0" upper="0.04" velocity="0.2"/>
    </joint>
    
    <!-- Wrist mounted camera -->
    <joint name="${ns}_camera_joint" type="fixed">
      <parent link="${ns}_hand"/>
      <child link="${ns}_camera"/>
      <origin xyz="0.05 0 0.05" rpy="3.141 -1.57 0"/>
      <axis xyz="0 1 0"/>
    </joint>
    <link name="${ns}_camera">
	  <visual>
	    <geometry>
		  <box size="0.05 0.05 0.05"/>
	    </geometry>
	  </visual>
      <collision>
		<geometry>
	      <box size="0.05 0.05 0.05"/>
	    </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.15625" />
        <inertia ixx="0.000065104" ixy="0.0" ixz="0.0" iyy="0.000065104" iyz="0.0" izz="0.000065104" />
      </inertial>
    </link>
        
    <joint name="${ns}_probe_cyl_joint" type="revolute">
      <parent link="${ns}_hand"/>
      <child link="${ns}_probe_cyl"/>
      <origin xyz="0 0 0.12" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
      <limit effort="20" lower="0.0" upper="0.0" velocity="0.0"/>
    </joint>
    
    <!-- 
    Masses and inertia based on density of PLA (1250 kg/m^3)
    Assumed uniform density 
    R = 0.03 m of ball
    r = 0.01 m of cyl
    L = 0.1 m of cyl
    I_ball = 2./5.*m_ball*R**2
    I_axis = 1./2.*m_cyl*r**2
    I_oAxis = 1./4.*m_cyl*r**2+1./12.*m_cyl*L**2
    -->
    
    <link name="${ns}_probe_cyl">
	  <visual>
	    <geometry>
		  <cylinder length="0.1" radius="0.01"/>
	    </geometry>
	  </visual>
      <collision>
		<geometry>
	      <cylinder length="0.1" radius="0.01"/>
	    </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.03926990816987242" />
        <inertia ixx="3.3706671179140497e-05" ixy="0.0" ixz="0.0" iyy="3.3706671179140497e-05" iyz="0.0" izz="1.963495408493621e-06" />
      </inertial>
    </link>
    
    <joint name="${ns}_probe_ball_joint" type="fixed">
      <parent link="${ns}_probe_cyl"/>
      <child link="${ns}_probe_ball"/>
      <origin xyz="0 0 0.07" rpy="0 0 0"/>
      <axis xyz="0 1 0"/>
    </joint>
    
    <link name="${ns}_probe_ball">
      <visual>
        <geometry>
		  <sphere radius="0.03"/>
        </geometry>
      </visual>
      <collision>
		<geometry>
	      <sphere radius="0.03"/>
	    </geometry>
      </collision>
      <inertial>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <mass value="0.033749999999999995" />
        <inertia ixx="1.2149999999999997e-05" ixy="0.0" ixz="0.0" iyy="1.2149999999999997e-05" iyz="0.0" izz="1.2149999999999997e-05" />
      </inertial>    
    </link>
  </xacro:macro>
</robot>
